<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Performance Tuning | @box2d</title>
    <meta name="generator" content="VuePress 1.8.3">
    
    <meta name="description" content="A full-blown ecosystem for box2d for the JavaScript/TypeScript world">
    
    <link rel="preload" href="/box2d.ts/docs/assets/css/0.styles.c947eaec.css" as="style"><link rel="preload" href="/box2d.ts/docs/assets/js/app.c1826c73.js" as="script"><link rel="preload" href="/box2d.ts/docs/assets/js/2.5162c252.js" as="script"><link rel="preload" href="/box2d.ts/docs/assets/js/16.318e943b.js" as="script"><link rel="prefetch" href="/box2d.ts/docs/assets/js/10.4063d13a.js"><link rel="prefetch" href="/box2d.ts/docs/assets/js/11.297f78d0.js"><link rel="prefetch" href="/box2d.ts/docs/assets/js/12.399f2064.js"><link rel="prefetch" href="/box2d.ts/docs/assets/js/13.ea7e5021.js"><link rel="prefetch" href="/box2d.ts/docs/assets/js/14.007af389.js"><link rel="prefetch" href="/box2d.ts/docs/assets/js/15.030a24a9.js"><link rel="prefetch" href="/box2d.ts/docs/assets/js/17.64a183da.js"><link rel="prefetch" href="/box2d.ts/docs/assets/js/3.281a1424.js"><link rel="prefetch" href="/box2d.ts/docs/assets/js/4.5b525bf9.js"><link rel="prefetch" href="/box2d.ts/docs/assets/js/5.9ddf28f8.js"><link rel="prefetch" href="/box2d.ts/docs/assets/js/6.29b588ee.js"><link rel="prefetch" href="/box2d.ts/docs/assets/js/7.c545d9ed.js"><link rel="prefetch" href="/box2d.ts/docs/assets/js/8.23236e66.js"><link rel="prefetch" href="/box2d.ts/docs/assets/js/9.bd1c742c.js">
    <link rel="stylesheet" href="/box2d.ts/docs/assets/css/0.styles.c947eaec.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/box2d.ts/docs/" class="home-link router-link-active"><!----> <span class="site-name">@box2d</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/box2d.ts/docs/guide/" class="nav-link router-link-active">
  Guide
</a></div><div class="nav-item"><a href="https://lusito.github.io/box2d.ts/benchmark/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Benchmarks
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://lusito.github.io/box2d.ts/testbed/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Demos
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/lusito/box2d.ts" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/box2d.ts/docs/guide/" class="nav-link router-link-active">
  Guide
</a></div><div class="nav-item"><a href="https://lusito.github.io/box2d.ts/benchmark/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Benchmarks
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://lusito.github.io/box2d.ts/testbed/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Demos
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/lusito/box2d.ts" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Getting Started</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Box2D</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Lights</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/box2d.ts/docs/guide/lights/" aria-current="page" class="sidebar-link">Lights</a></li><li><a href="/box2d.ts/docs/guide/lights/getting-started.html" class="sidebar-link">Getting Started</a></li><li><a href="/box2d.ts/docs/guide/lights/glossary.html" class="sidebar-link">Glossary</a></li><li><a href="/box2d.ts/docs/guide/lights/custom-viewport.html" class="sidebar-link">Custom Viewport</a></li><li><a href="/box2d.ts/docs/guide/lights/performance-tuning.html" aria-current="page" class="active sidebar-link">Performance Tuning</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Particles</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Controllers</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="performance-tuning"><a href="#performance-tuning" class="header-anchor">#</a> Performance Tuning</h1> <p>The following is copied from the original documentation and <strong>might need to be adjusted</strong> for the TypeScript version:</p> <h2 id="object-creation"><a href="#object-creation" class="header-anchor">#</a> Object creation</h2> <ul><li>Ray Handler is heavy weight object. It contains many float arrays and couple FBO's when openGL es 2.0 is available. Ray Handler can be safely used over the application lifetime. Ray Handler need to be disposed when its destroyed.</li> <li>Lights are moderate weight objects. Every light contain two mesh and if possible try to reuse these lights. Just set light to disabled if you know that you will be needing another that type of light soon. Remove lights if you don't need them anymore or there is big time window between them. Be aware that setActive(false) do not set body reference to null.</li></ul> <h2 id="performance-tips"><a href="#performance-tips" class="header-anchor">#</a> Performance tips</h2> <ul><li>Tips are marked with <em>(CPU | GPU | MEMORY)</em> depending which part of system that tip might help.</li> <li>Disabled light do not have any performance overhead. Disable lights are stored on separate list. <em>(CPU &amp; GPU)</em></li> <li>Disable shadows if game is running on platform with GL es 1.0 and where render target do not have alpha channel. Usually this mean android with gles1.0. This maybe can be done automatically in library but don't count on that! <em>(GPU)</em></li> <li>Static flag make light very cheap. You can use static light even for objects that move but they do it rarely. Static lights can be attached to bodies but they do not follow body movement after initial attach call. Every time you call method that alter static light state it has to be updated. Static lights is wrong choice if light is updated every frame. <em>(CPU)</em></li> <li>Xray flag prevent all the raycasting for the light. So this lower cpu load about 80%. Xrays are optimal for small objects and usually dynamic light look better/smoother when combined with xray pointlight. Use this flag allways when you don't need dynamic behavior. <em>(CPU)</em></li> <li>Setting FBO size to small make really big difference with performance. First it helps with light drawing because its use less fillrate. Secondly it help with blurring. One blur pass use 5+5 dynamic texture fetch. With 800x480 screen: using original screen size as fbo size and three blur pass would need over 10 million texture look ups. But using box2dLights defaults settings 200x120(quarter of screen sizes) and one blur pass use only 240 000 texture look ups but yield more smoothed look. <em>(GPU &amp; MEMORY)</em></li> <li>Blur passes are heavyweight, try to smaller fbo combined with more passes if really blurred lights are needed. Idea for blur algorithm can be found here http://rastergrid.com/blog/2010/09/efficient-gaussian-blur-with-linear-sampling/ <em>(GPU)</em></li> <li>For dynamic lights use only that amount rays that are absolute needed. Usually best outcome is somewhere between 5 and 128. For something really accurate and visible you sometimes need more but be careful. For every ray box2dLights have to use one raycast and 1 vertex + 2 for soft light.<em>(CPU &amp; GPU &amp; MEMORY)</em></li> <li>Light distance make light a bit heavier. Ray Cast need to travel bigger distance and more pixels need to drawn. For bigger light try first add color alpha channel and maybe add some white color. If that does not help try to use different fallof scheme(Still WIP).<em>(CPU &amp; GPU)</em></li> <li>Set culling enabled. Culling is very lightweight process but safe all raycast calculations and drawing. Lights are culled automatically if they are so much off screen that even lights tips would never occur in screen. Culled light is still not free so if you know something is behind camera really long time maybe that could be disabled.<em>(CPU &amp; GPU)</em></li> <li>Be reasonable with soft light distance and turn softness off it that is not needed.<em>(CPU &amp; GPU)</em></li> <li>Only create rayHandler with maxNumberRays that are needed <em>(MEMORY)</em></li> <li>If physics are stepped more sparsely than game is rendered ray handler update can be skipped if physic did not skipped between frames. If physics are updated more often that game is rendered then calling updateAndRender is best choice.<em>(CPU)</em></li> <li>If not single lights are rendered blurring and light map blitting is skipped. So cull/disable lights that are not visible (GPU)</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/box2d.ts/docs/guide/lights/custom-viewport.html" class="prev">
        Custom Viewport
      </a></span> <span class="next"><a href="/box2d.ts/docs/guide/particles/">
        Particles
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/box2d.ts/docs/assets/js/app.c1826c73.js" defer></script><script src="/box2d.ts/docs/assets/js/2.5162c252.js" defer></script><script src="/box2d.ts/docs/assets/js/16.318e943b.js" defer></script>
  </body>
</html>
